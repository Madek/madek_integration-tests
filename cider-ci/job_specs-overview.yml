integration-tests_overview:

  name: Integration-Tests Overview

  description: |
    Render a html page showing an overview of all the specs
    run during the integration tests.

  run-on:
    - type: branch
      include-match: ^.*$

  context:

    task-defaults:

      git-options:
        submodules:
          clone:
            exclude-match: deploy
          timeout: 60
      max-auto-trials: 1

      traits:
        bash: true
        git: true
        linux: true
        rbenv: true
        ruby: true

    subcontexts:

      - name: Unit

        _cider-ci_include: cider-ci/contexts/unit_defaults.yml

        tasks:
          render_specs:
            name: 'Rspec: HTML summary'
            trial-attachments:
              spec_doc_trial:
                content-type: text/html
                include-match: spec_doc\/.*\.html$
            tree-attachments:
              spec_doc:
                content-type: text/html
                include-match: spec_doc\/.*\.html$
            scripts:
              test:
                body: |
                  mkdir spec_doc
                  cd integration-tests
                  ../webapp/cider-ci/bin/render-specs.js spec/features > ../spec_doc/integration-tests_overview.html

